<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¿å‹™æ´»å‹•è²» è²»ç›®åˆ†åˆ¥ã‚¢ãƒ—ãƒª</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #f4f7f6;
            margin: 0;
            padding: 0;
            color: #333;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .navbar {
            background-color: #ffffff;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
        }
        .logo {
            display: flex;
            align-items: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }
        .logo span { margin-left: 10px; }
        .user-info { font-size: 0.9rem; color: #666; }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .container {
            max-width: 1000px;
            margin: 40px auto;
            padding: 0 20px;
            text-align: center;
        }

        h1 { margin-bottom: 10px; font-size: 2rem; }
        .subtitle { color: #666; margin-bottom: 40px; font-size: 0.95rem; line-height: 1.6; }

        /* ã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰ */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background: white;
            padding: 30px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: transform 0.2s;
            text-align: left;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 200px;
        }
        .card:hover { transform: translateY(-5px); }
        
        .icon-box {
            width: 50px; height: 50px;
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; margin-bottom: 15px;
        }
        .bg-blue { background-color: #e3f2fd; color: #1976d2; }
        .bg-green { background-color: #e8f5e9; color: #388e3c; }
        .bg-purple { background-color: #f3e5f5; color: #7b1fa2; }
        .bg-orange { background-color: #fff3e0; color: #f57c00; }

        .card h3 { margin: 0 0 10px 0; font-size: 1.1rem; }
        .card p { font-size: 0.85rem; color: #666; margin-bottom: 20px; flex-grow: 1; }

        .btn {
            display: block;
            text-align: center;
            padding: 10px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            border: 1px solid #ddd;
            background: white;
            color: #333;
            transition: 0.2s;
        }
        .btn-primary { background-color: #2563eb; color: white; border: none; }
        .btn-primary:hover { background-color: #1d4ed8; }
        .btn-outline:hover { background-color: #f5f5f5; }

        /* ç”»é¢åˆ‡ã‚Šæ›¿ãˆã‚¨ãƒªã‚¢ */
        .view-section { display: none; background: white; padding: 30px; border-radius: 12px; text-align: left; margin-top: 20px; }
        .view-section.active { display: block; }
        .back-btn { margin-bottom: 20px; cursor: pointer; color: #2563eb; text-decoration: underline; background: none; border: none; font-size: 1rem;}

        /* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ */
        .upload-area {
            border: 2px dashed #ccc; padding: 40px; text-align: center; border-radius: 10px; cursor: pointer;
        }
        .upload-area:hover { background-color: #fafafa; border-color: #2563eb; }

        /* å±¥æ­´ãƒªã‚¹ãƒˆç”»åƒ */
        .receipt-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; }
        .receipt-item img { width: 100%; height: 100px; object-fit: cover; border-radius: 5px; border: 1px solid #eee; }
    </style>
</head>
<body>

    <div class="navbar">
        <div class="logo">
            <span style="background:#2563eb; color:white; padding:5px; border-radius:5px;">ğŸ§¾</span>
            <span>æ”¿å‹™æ´»å‹•è²» è²»ç›®åˆ†åˆ¥ã‚¢ãƒ—ãƒª</span>
        </div>
        <div class="user-info">KENTARO TAKAHASHI | ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</div>
    </div>

    <div class="container" id="dashboard">
        <h1>æ”¿å‹™æ´»å‹•è²»ã®ç®¡ç†ã‚’ç°¡å˜ã«</h1>
        <p class="subtitle">
            ãƒ¬ã‚·ãƒ¼ãƒˆç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã ã‘ã§ã€è‡ªå‹•çš„ã«è²»ç›®ã‚’åˆ†åˆ¥ã—ã€é›†è¨ˆçµæœã‚’ç¢ºèªã§ãã¾ã™ã€‚<br>
            æ”¿å‹™æ´»å‹•è²»ã®ç®¡ç†æ¥­å‹™ã‚’åŠ¹ç‡åŒ–ã—ã¾ã™ã€‚
        </p>

        <div class="grid">
            <div class="card">
                <div>
                    <div class="icon-box bg-blue">ğŸ“¤</div>
                    <h3>ãƒ¬ã‚·ãƒ¼ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h3>
                    <p>ã‚¹ãƒãƒ›ã§æ’®å½±ã—ãŸãƒ¬ã‚·ãƒ¼ãƒˆç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€è‡ªå‹•ã§æƒ…å ±ã‚’æŠ½å‡ºã—ã¾ã™ã€‚</p>
                </div>
                <button class="btn btn-primary" onclick="showView('upload-view')">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
            </div>

            <div class="card">
                <div>
                    <div class="icon-box bg-green">ğŸ“„</div>
                    <h3>ãƒ¬ã‚·ãƒ¼ãƒˆä¸€è¦§</h3>
                    <p>ç™»éŒ²æ¸ˆã¿ã®ãƒ¬ã‚·ãƒ¼ãƒˆã‚’ç¢ºèªãƒ»ç·¨é›†ã§ãã¾ã™ã€‚è²»ç›®ã‚„æŒ‰åˆ†æ¯”ç‡ã®å¤‰æ›´ã‚‚å¯èƒ½ã§ã™ã€‚</p>
                </div>
                <button class="btn btn-outline" onclick="showView('list-view')">ä¸€è¦§ã‚’è¦‹ã‚‹</button>
            </div>

            <div class="card">
                <div>
                    <div class="icon-box bg-purple">ğŸ“Š</div>
                    <h3>é›†è¨ˆçµæœ</h3>
                    <p>è²»ç›®ã”ã¨ã®åˆè¨ˆé‡‘é¡ã‚’ç¢ºèªã§ãã¾ã™ã€‚æ”¿å‹™æ´»å‹•è²»ã®æ”¯å‡ºçŠ¶æ³ã‚’ä¸€ç›®ã§æŠŠæ¡ã§ãã¾ã™ã€‚</p>
                </div>
                <button class="btn btn-outline" onclick="showView('summary-view')">é›†è¨ˆã‚’è¦‹ã‚‹</button>
            </div>

            <div class="card">
                <div>
                    <div class="icon-box bg-orange">âš™ï¸</div>
                    <h3>æŒ‰åˆ†åŸºæº–ç®¡ç†</h3>
                    <p>è²»ç›®ã”ã¨ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæŒ‰åˆ†æ¯”ç‡ã‚„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã§ãã¾ã™ã€‚</p>
                </div>
                <button class="btn btn-outline" onclick="alert('ç¾åœ¨ã¯è¨­å®šç”»é¢ã¯æº–å‚™ä¸­ã§ã™')">ç®¡ç†ç”»é¢</button>
            </div>
        </div>

        <h3 style="text-align: center; color: #333; margin-top: 50px;">ä¸»ãªæ©Ÿèƒ½</h3>
    </div>

    <div class="container view-section" id="upload-view">
        <button class="back-btn" onclick="showDashboard()">â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹</button>
        <h2>ğŸ“¤ ãƒ¬ã‚·ãƒ¼ãƒˆã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>
        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <p>ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã€ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</p>
            <input type="file" id="fileInput" accept="image/*" style="display: none" onchange="uploadReceipt()">
        </div>
        <div id="uploadResult" style="margin-top: 20px; font-weight: bold;"></div>
    </div>

    <div class="container view-section" id="list-view">
        <button class="back-btn" onclick="showDashboard()">â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹</button>
        <h2>ğŸ“„ ç™»éŒ²æ¸ˆã¿ãƒ¬ã‚·ãƒ¼ãƒˆä¸€è¦§</h2>
        <div id="gallery" class="receipt-list">èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>

    <div class="container view-section" id="summary-view">
        <button class="back-btn" onclick="showDashboard()">â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹</button>
        <h2>ğŸ“Š æ”¯å‡ºé›†è¨ˆï¼ˆãƒ‡ãƒ¢ï¼‰</h2>
        <canvas id="expenseChart" width="400" height="200"></canvas>
    </div>

    <script>
        // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
        function showView(viewId) {
            document.getElementById('dashboard').style.display = 'none';
            document.querySelectorAll('.view-section').forEach(el => el.style.display = 'none');
            document.getElementById(viewId).style.display = 'block';

            if(viewId === 'list-view') loadHistory();
            if(viewId === 'summary-view') renderChart();
        }

        function showDashboard() {
            document.querySelectorAll('.view-section').forEach(el => el.style.display = 'none');
            document.getElementById('dashboard').style.display = 'block';
        }

        // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        async function uploadReceipt() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length === 0) return;

            const formData = new FormData();
            formData.append("file", fileInput.files[0]);
            
            document.getElementById('uploadResult').innerText = "â³ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...";

            try {
                const res = await fetch('/api/ocr/upload', { method: 'POST', body: formData });
                if(res.ok) {
                    const data = await res.json();
                    document.getElementById('uploadResult').innerText = "âœ… ä¿å­˜æˆåŠŸ: " + data.filename;
                    document.getElementById('uploadResult').style.color = "green";
                } else {
                    throw new Error("Error");
                }
            } catch(e) {
                document.getElementById('uploadResult').innerText = "âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
                document.getElementById('uploadResult').style.color = "red";
            }
        }

        // å±¥æ­´èª­ã¿è¾¼ã¿
        async function loadHistory() {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = "èª­ã¿è¾¼ã¿ä¸­...";
            const res = await fetch('/api/ocr/list');
            const data = await res.json();
            gallery.innerHTML = "";
            
            if(data.files.length === 0) gallery.innerHTML = "ã¾ã ç”»åƒãŒã‚ã‚Šã¾ã›ã‚“";

            data.files.forEach(file => {
                const div = document.createElement('div');
                div.className = 'receipt-item';
                div.innerHTML = `<a href="/uploads/${file}" target="_blank"><img src="/uploads/${file}"></a>`;
                gallery.appendChild(div);
            });
        }

        // ã‚°ãƒ©ãƒ•æç”»ï¼ˆãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼‰
        function renderChart() {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            // ã™ã§ã«ãƒãƒ£ãƒ¼ãƒˆãŒã‚ã‚‹å ´åˆã¯ç ´æ£„ï¼ˆäºŒé‡æç”»é˜²æ­¢ï¼‰
            if(window.myChart) window.myChart.destroy();

            window.myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['èª¿æŸ»ç ”ç©¶è²»', 'ç ”ä¿®è²»', 'åºƒè´åºƒå ±è²»', 'è¦è«‹é™³æƒ…ç­‰æ´»å‹•è²»', 'ä¼šè­°è²»', 'è³‡æ–™ä½œæˆè²»'],
                    datasets: [{
                        label: 'æ”¯å‡ºé¡ (å††)',
                        data: [12000, 5000, 30000, 8000, 1500, 20000], // ã“ã“ã¯ã¾ã ãƒ€ãƒŸãƒ¼ã§ã™
                        backgroundColor: '#2563eb'
                    }]
                },
                options: { scales: { y: { beginAtZero: true } } }
            });
        }
    </script>
</body>
</html>
